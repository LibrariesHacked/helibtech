{%- comment -%}
The site tags component should list all tags used in the site.
At the top of the page each tag will be a link to link to the tag header on the page.
It should then have each tag as a header and list all the pages that include that tag.
{%- endcomment -%}

{% assign tags = site.metatags %}

{% if tags.size > 0 %}

<h2>List of site tags</h2>
<div class="metatags">
  {% for tag in tags %}
  {% assign tag_pages = site.pages | where_exp: "page", "page.tags contains tag.title" %}
  {% if tag_pages.size > 0 %}
  <p class="label"><a href="#{{ tag.title | slugify }}">{{ tag.title }}</a> {{ tag_pages.size }}</p>
  {% endif %}
  {% endfor %}
</div>

<h3>Pages by tag</h3>
{% for tag in tags %}
{% assign tag_pages = site.pages | where_exp: "page", "page.tags contains tag.title" %}
{% if tag_pages.size > 0 %}
<h4 id="{{ tag.title | slugify }}">{{ tag.title }}</h4>
<div>
  <ul>
    {% for page in tag_pages %}
    <li>
      {% if page.parent %}
      {{ page.parent }}:
      {% endif %}
      <a href="{{ page.url | relative_url }}">{{ page.title }}</a>
    </li>
    {% endfor %}
  </ul>
</div>
{% endif %}
{% endfor %}

{% endif %}